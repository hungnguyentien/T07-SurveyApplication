<p-toast [style]="{ width: '20vw', height: '5vh' }"></p-toast>
<div>
  <h5>Danh sách gửi email</h5>
  <form class="form-inline mt-4">
    <div class="form-group mb-2">
      <label for="inputPassword2" class="sr-only">Search</label>
      <input type="text" class="form-control" id="inputPassword2" placeholder="Nhập từ khoá" [(ngModel)]="keyword"
        name="keyword">
    </div>
    <button type="submit" class="btn btn-primary ml-2 mb-2">
      <i class="pi pi-search"></i>
    </button>
  </form>
</div>
<div class="card mt-3">
  <p-table #dt ngClass="cust-tbl" [value]="datas" [lazy]="true" (onLazyLoad)="loadListLazy($event)" [scrollable]="true"
    scrollHeight="calc(100vh - 396px)" [(selection)]="selectedSendEmail" dataKey="id"
    styleClass="p-datatable-gridlines p-datatable-striped" [rowHover]="true" [rows]="10" [showCurrentPageReport]="true"
    [rowsPerPageOptions]="[10, 25, 50]" [loading]="loading" [paginator]="true" [totalRecords]="dataTotalRecords"
    currentPageReportTemplate="Hiển thị từ {first} đến {last} của {totalRecords} bản ghi" [filterDelay]="0">
    <ng-template pTemplate="header">
      <tr>
        <th style="min-width: 0rem">
          STT
        </th>
        <th style="min-width: 8rem">
          <div class="flex justify-content-between align-items-center">
            Mã bảng ks
            <div type="text" display="menu" class="ml-auto"></div>
          </div>
        </th>
        <th style="min-width: 14rem">
          <div class="flex justify-content-between align-items-center">
            Tên bảng khảo sát
            <div type="text" display="menu" class="ml-auto"></div>
          </div>
        </th>
        <th style="min-width: 8rem">
          <div class="flex justify-content-between align-items-center">
            Email đã gửi
            <div type="text" display="menu" class="ml-auto"></div>
          </div>
        </th>
        <th style="min-width: 8rem">
          <div class="flex justify-content-between align-items-center">
            Thành Công
            <div type="text" display="menu" class="ml-auto"></div>
          </div>
        </th>
        <th style="min-width: 8rem">
          <div class="flex justify-content-between align-items-center">
            Gửi lỗi
            <div type="text" display="menu" class="ml-auto"></div>
          </div>
        </th>
        <th style="min-width: 8rem">
          <div class="flex justify-content-between align-items-center">
            Thu hồi
            <div type="text" display="menu" class="ml-auto"></div>
          </div>
        </th>
        <th style="min-width: 8rem">
          <div class="flex justify-content-between align-items-center">
            Thời gian
            <div type="text" display="menu" class="ml-auto"></div>
          </div>
        </th>
        <th style="min-width: 6rem">
          <div>
            Chức năng
          </div>
        </th>

      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
      <tr class="p-selectable-row">
        <td>
          <span class="p-column-title">STT</span>
          {{ rowIndex + 1}}
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">{{ rowData.maBangKhaoSat }}</span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">{{ rowData.tenBangKhaoSat }}</span>
        </td>
        <td class="text-end">
          <b class="ml-1 vertical-align-middle">{{ rowData.countSendEmail }}</b>
        </td>
        <td class="text-end">
          <b class="ml-1 vertical-align-middle" style="color: rgba(36, 119, 69, 1)">{{ rowData.countSendThanhCong
            }}</b>
        </td>
        <td class="text-end">
          <b class="ml-1 vertical-align-middle" style="color: rgba(229, 13, 13, 1)">{{ rowData.countSendLoi }}</b>
        </td>
        <td class="text-end">
          <b class="ml-1 vertical-align-middle">{{ rowData.countSendThuHoi }}</b>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">{{rowData.ngayBatDau | date:'dd/MM/yyyy'}} - {{rowData.ngayKetThuc
            |
            date:'dd/MM/yyyy'}}</span>
        </td>
        <td>
          <div class="d-flex align-items-center justify-content-center">
            <a (click)="detailDialog(rowData)">
              <i class="pi pi-eye" style="color: rgba(2, 136, 209, 1)" title="Chi tiết" aria-hidden="true"></i>
            </a>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="9" class="text-center">Không có bản ghi nào</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-dialog header="Header" [(visible)]="visible" [modal]="true" [style]="{ width: '60vw' }" [draggable]="false"
  [resizable]="true" [maximizable]="true">
  <ng-template pTemplate="header">
    <h5 class="modal-title">
      Chi tiết gửi email
    </h5>
  </ng-template>
  <ng-template pTemplate="body">
    <div class="form-group form-inline col-md-12 mb-0">
      <div class="col-2">
        <div class="col-form-label text-end">Mã bảng:</div>
      </div>
      <div class="col-10">
        <div class="col-form-label text-start"><b>{{maBangKhaoSat}}</b></div>
      </div>
    </div>
    <div class="form-group form-inline col-md-12 mb-0">
      <div class="col-2">
        <div class="col-form-label text-end">Tên bảng:</div>
      </div>
      <div class="col-10">
        <div class="col-form-label text-start"><b>{{tenBangKhaoSat}}</b></div>
      </div>
    </div>
    <div class="form-group form-inline col-md-12 mb-0">
      <div class="col-2">
        <div class="col-form-label text-end">Danh sách email gửi:</div>
      </div>
      <div class="col-10">
        <p-tabView [(activeIndex)]="activeIndex">
          <p-tabPanel>
            <ng-template pTemplate="header">
              <p-button (click)="activeTabIndex(0)" styleClass="p-button-text" label="Tất cả"></p-button>
            </ng-template>
          </p-tabPanel>
          <p-tabPanel>
            <ng-template pTemplate="header">
              <p-button (click)="activeTabIndex(1)" styleClass="p-button-text" label="Thành công"></p-button>
            </ng-template>
          </p-tabPanel>
          <p-tabPanel>
            <ng-template pTemplate="header">
              <p-button (click)="activeTabIndex(2)" styleClass="p-button-text" label="Gửi Lỗi"></p-button>
            </ng-template>
          </p-tabPanel>
          <p-tabPanel>
            <ng-template pTemplate="header">
              <p-button (click)="activeTabIndex(3)" styleClass="p-button-text" label="Thu hồi"></p-button>
            </ng-template>
          </p-tabPanel>
        </p-tabView>

        <p-table #dtGe ngClass="cust-tbl" [value]="datasGe" [lazy]="true" (onLazyLoad)="loadListLazyGe($event)"
          [scrollable]="true" scrollHeight="calc(100vh - 396px)" [(selection)]="selectedGe" dataKey="id"
          styleClass="p-datatable-gridlines p-datatable-striped" [rowHover]="true" [rows]="10"
          [showCurrentPageReport]="true" [rowsPerPageOptions]="[10, 25, 50]" [loading]="loadingGe" [paginator]="true"
          [totalRecords]="dataTotalRecordsGe"
          currentPageReportTemplate="Hiển thị từ {first} đến {last} của {totalRecords} bản ghi" [filterDelay]="0"
          [resizableColumns]="true">
          <ng-template pTemplate="header">
            <tr>
              <th pResizableColumn>
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
              <th pResizableColumn>
                STT
              </th>
              <th pResizableColumn>
                Email
              </th>
              <th pResizableColumn>
                Đơn vị
              </th>
              <th pResizableColumn>
                Thời gian
              </th>
              <th pResizableColumn>
                Người thực hiện
              </th>
              <th pResizableColumn>
                Trạng thái
              </th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
            <tr class="p-selectable-row">
              <td>
                <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
              </td>
              <td>
                {{ rowIndex + 1}}
              </td>
              <td>
                <span class="vertical-align-middle">{{ rowData.diaChiNhan }}</span>
              </td>
              <td>
                <span class="vertical-align-middle">{{ rowData.tenDonVi }}</span>
              </td>
              <td>
                <span class="vertical-align-middle">{{ rowData.thoiGian | date:'dd/MM/yyyy'}}</span>
              </td>
              <td>
                <span class="vertical-align-middle">{{ rowData.nguoiThucHien }}</span>
              </td>
              <td class="text-end">
                <span class="vertical-align-middle" [appHighlightGuiEmail]="rowData.trangThai">
                  <ng [ngSwitch]="rowData.trangThai">
                    <ng-container *ngSwitchCase="0">Thành công</ng-container>
                    <ng-container *ngSwitchCase="1">Gửi lỗi</ng-container>
                    <ng-container *ngSwitchCase="2">Thu hồi</ng-container>
                    <ng-container *ngSwitchDefault>Đang gửi</ng-container>
                  </ng>
                </span>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="7" class="text-center">Không có bản ghi nào</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <button type="button" pButton class="custom-button" label="Gửi Email" icon="pi pi-envelope"
      style="background-color: #eec24a;"></button>
    <button type="button" pButton class="custom-button" label="Thu hồi" icon="pi pi-envelope"
      style="background-color: rgba(65, 76, 82, 1);"></button>
      <button type="button" pButton class="custom-button" label="Đóng" (click)="visible = false"
      style="background-color: rgba(0, 0, 0, 0);color: rgba(0, 0, 0, 1);border: 1px solid rgba(65, 76, 82, 1);"></button>
  </ng-template>
</p-dialog>