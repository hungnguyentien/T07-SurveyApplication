<div>
  <h5>Bảng thống kê khảo sát</h5>
  <div class="d-flex">
    <form class="w-100" [formGroup]="frmStatiscal" (ngSubmit)="search()">
      <div class="col-12">
        <div class="row">
          <div class="form-group form-inline col-4 mb-0 pb-0">
            <div class="col-3">
              <label for="idDotKhaoSat">Đợt khảo sát <span style="color: red;">*</span></label>
            </div>
            <div class="col-9">
              <p-dropdown id="idDotKhaoSat" [options]="LstDotKhaoSat" optionLabel="tenDotKhaoSat" optionValue="id"
                [filter]="true" filterBy="tenDotKhaoSat" emptyMessage="Không có kết quả nào"
                emptyFilterMessage="Không tìm thấy kết quả" [showClear]="true" class="form-select-custom"
                placeholder="-- Chọn đợt khảo sát --" formControlName="idDotKhaoSat">
              </p-dropdown>
            </div>
          </div>
          <div class="form-group form-inline col-4 mb-0 pb-0">
            <div class="col-3">
              <label for="idBangKhaoSat">Bảng khảo sát <span style="color: red;">*</span></label>
            </div>
            <div class="col-9">
              <p-dropdown id="idBangKhaoSat" [options]="LstBangKhaoSat" optionLabel="tenBangKhaoSat" optionValue="id"
                [filter]="true" filterBy="tenBangKhaoSat" emptyMessage="Không có kết quả nào"
                emptyFilterMessage="Không tìm thấy kết quả" [showClear]="true" class="form-select-custom"
                placeholder="-- Chọn bảng khảo sát --" formControlName="idBangKhaoSat">
              </p-dropdown>
            </div>
          </div>
          <div class="form-group form-inline col-4 mb-0 pb-0">
            <div class="col-3">
              <label for="idLoaiHinh">Đối tượng</label>
            </div>
            <div class="col-9">
              <p-dropdown id="idLoaiHinh" [options]="LstLoaiHinhDv" optionLabel="tenLoaiHinh" optionValue="id"
                [filter]="true" filterBy="tenLoaiHinh" emptyMessage="Không có kết quả nào"
                emptyFilterMessage="Không tìm thấy kết quả" [showClear]="true" class="form-select-custom"
                placeholder="-- Chọn loại hình đơn vị --" formControlName="idLoaiHinh">
              </p-dropdown>
              <small style="color: #e24c4c;" class="ml-2" *ngIf="!frmStatiscal.controls['idLoaiHinh'].valid && 
                            frmStatiscal.controls['idLoaiHinh'].dirty">
                Vui lòng chọn bảng khảo sát
              </small>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group form-inline col-4 mb-0 pt-0">
            <div class="col-3">
              <label for="ngayBatDau">Ngày bắt đầu</label>
            </div>
            <div class="col-9">
              <p-calendar formControlName="ngayBatDau" id="ngayBatDau" class="input-date-custom" dateFormat="dd/mm/yy"
                [showIcon]="true" [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}"></p-calendar>
            </div>
          </div>
          <div class="form-group form-inline col-4 mb-0 pt-0">
            <div class="col-3">
              <label for="ngayKetThuc">Ngày kết thúc</label>
            </div>
            <div class="col-9">
              <p-calendar formControlName="ngayKetThuc" id="ngayKetThuc" class="input-date-custom" dateFormat="dd/mm/yy"
                [showIcon]="true" [style]="{'width':'100%'}" [inputStyle]="{'width':'100%'}"></p-calendar>
            </div>
          </div>
          <div class="form-group form-inline col-4  mb-0 pt-0">
            <button pButton type="submit" icon="pi pi-search" label="Tìm kiếm"
              class="btn btn-primary custom-button mr-2" style="padding: 9.25px 20px;">
            </button>
            <button pButton type="button" icon="pi pi-refresh" label="Reset" (click)="reset()"
              class="btn btn-primary custom-button" style="padding: 9.25px 20px;">
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
  <hr>
</div>

<div class="card mt-3">
  <div class="row">
    <div class="col-6">
      <div class="flex justify-content-center">
        <p-chart type="doughnut" [data]="doughnutData" [options]="doughnutOptions"></p-chart>
      </div>
    </div>
    <div class="col-6">
      <div class="flex justify-content-center h-100">
        <p-chart type="bar" [data]="barData" [options]="barOptions"></p-chart>
      </div>
    </div>
  </div>
</div>

<div class="card mt-3">
  <div class="row">
    <p-tabView class="col-md-12">
      <p-tabPanel header="Tổng quan">
        <div class="d-flex ml-3">
          <div class=" d-flex">
            <button pButton type="button" icon="pi pi-file-export" label="Xuất dữ liệu" class="custom-button"
              style="background-color: green;" (click)="exportToExcel()">
            </button>
          </div>
        </div>
        <div class="card mt-3">
          <p-table #dt ngClass="cust-tbl" [value]="datas" [lazy]="true" [scrollable]="true"
            scrollHeight="calc(250vh - 396px)" dataKey="id" styleClass="p-datatable-gridlines p-datatable-striped"
            [rowHover]="true">
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 60px;text-align: center;">
                  STT
                </th>
                <th pResizableColumn>
                  <div class="flex justify-content-between align-items-center">
                    Câu hỏi
                  </div>
                </th>
                <th pResizableColumn>
                  <div class="flex justify-content-between align-items-center">
                    Câu trả lời
                  </div>
                </th>
                <th style="width: 150px;">
                  <div class="flex justify-content-between align-items-center">
                    Số lượt chọn
                  </div>
                </th>
                <th style="width: 100px;">
                  <div class="flex justify-content-between align-items-center">
                    Tỷ lệ (%)
                  </div>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
              <tr class="table-row">
                <td class="text-center align-items-center">
                  <span class="p-column-title">STT</span>
                  {{ rowIndex + 1}}
                </td>
                <td>
                  <p>{{ rowIndex }}</p>
                </td>
                <td>
                  <p *ngFor="let cauTraLoi of rowData.cauHoiTraLoi">{{ cauTraLoi.cauTraLoi }}</p>
                </td>
                <td rowspan="1">
                  <p *ngFor="let cauTraLoi of rowData.cauHoiTraLoi">{{ cauTraLoi.soLuotChon }}</p>
                </td>
                <td rowspan="1">
                  <p *ngFor="let cauTraLoi of rowData.cauHoiTraLoi">{{ cauTraLoi.tyLe }}%</p>
                </td>
              </tr>
            </ng-template>

          </p-table>
        </div>
      </p-tabPanel>

      <p-tabPanel header="Chi tiết kết quả khảo sát">
        <div class="d-flex mt-3">
          <div class="ml-3">
            <button pButton type="button" icon="pi pi-file-export" label="Xuất Excel" class="custom-button"
              style="background-color: green;" (click)="exportToExcel()">
            </button>
          </div>
          <div class="ml-3">
            <button pButton type="button" icon="pi pi-file-export" label="Xuất PDF" class="custom-button"
              style="background-color: #eab308;">
            </button>
          </div>
          <div class="ml-3">
            <form class="form-inline">
              <div class="form-group mb-2">
                <label for="keyWord" class="sr-only">Search</label>
                <input type="search" class="form-control" id="keyWord" placeholder="Nhập từ khoá " />
              </div>
              <button type="submit" class="btn btn-primary ml-2 mb-2">
                <i class="pi pi-search"></i>
              </button>
            </form>
          </div>
        </div>
        <div class="card mt-3">
          <table class="table table-bordered mb-0">
            <thead>
              <tr>
                <th>STT</th>
                <th>Dấu thời gian</th>
                <th *ngFor="let col of lstTh; trackBy:trackByFn">
                  {{ col }}
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of datas; index as i; trackBy:trackByFn">
                <td>{{i+1}}</td>
                <td>{{item.dauThoiGian | date:'dd/MM/yyyy hh:ss'}}</td>
                <td *ngFor="let item of item.lstCauHoiCauTraLoi; trackBy:trackByFn">
                  <div [ngSwitch]="item.loaiCauHoi">
                    <div *ngSwitchCase="5">
                      <p *ngFor="let item of item.cauTraLoi; trackBy:trackByFn">{{getDataKqBangMotLuaChon(item)}}</p>
                    </div>
                    <div *ngSwitchCase="2">
                      <p *ngFor="let item of item.cauTraLoi; trackBy:trackByFn">{{item}}</p>
                    </div>
                    <div *ngSwitchCase="7">
                      <div *ngFor="let item of item.cauTraLoi; trackBy:trackByFn">
                        <a (click)="downloadFileBase64(item)"
                          *ngFor="let item of getDataKqFile(item); trackBy:trackByFn" title="{{item.name}}">
                          {{item.name}}
                        </a>
                      </div>
                    </div>
                    <div *ngSwitchDefault>
                      <p *ngFor="let item of item.cauTraLoi; trackBy:trackByFn">{{getDataKq(item)}}</p>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>

</div>