<p-toast [style]="{ width: '20vw', height: '5vh' }"></p-toast>
<p-confirmDialog #cd [style]="{width: '30vw'}">
    <ng-template pTemplate="header">
        <h5>Xác nhận xoá đơn vị</h5>
    </ng-template>
    <ng-template pTemplate="footer">
        <button type="button" pButton icon="pi pi-times" class="custom-small-button" label="No" (click)="cd.reject()"></button>
        <button type="button" pButton icon="pi pi-check" class="custom-small-button" label="Yes" (click)="cd.accept()"></button>
    </ng-template>
</p-confirmDialog>

<div>
    <h5>Quản lý đơn vị</h5>
    <div class="d-flex mt-3">
      <div>
          <button (click)=" Add()" data-toggle="modal" data-target="#createForm" pButton type="button" icon="pi pi-plus" label="Thêm mới" class="custom-button"></button>
      </div>
      <div class="ml-3">
          <button pButton type="button" icon="pi pi-trash" label="Xoá" class="custom-button" style="background-color: #ea5c5c;"></button>
      </div>
  </div>
  <form class="form-inline mt-4" (change)="GetObjectSurvey()">
      <div class="form-group mb-2">
        <label for="inputPassword2" class="sr-only">Search</label>
        <input type="text" class="form-control" id="inputPassword2" placeholder="Nhập từ khoá" [(ngModel)]="keyword" name="keyword"(change)="GetObjectSurvey()">
      </div>
      <button type="submit" class="btn btn-primary ml-2 mb-2"><i class="pi pi-search"></i></button>
  </form>
</div>
<div class="card mt-3">
  <p-table
      #dt
      [value]="datas"
      [(selection)]="selectedObjectSurvey"
      dataKey="id"
      styleClass="p-datatable-gridlines"
      [rowHover]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      [filterDelay]="0">
      <ng-template pTemplate="header">
          <tr>
              <th style="width: 4rem">
                  <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
              <th style="min-width: 0rem">
                  STT
              </th>
              <th  style="min-width: 14rem">
                  <div class="flex justify-content-between align-items-center">
                      Mã<div type="text" display="menu" class="ml-auto"></div>
                  </div>
              </th>
              <th  style="min-width: 16rem">
                  <div class="flex justify-content-between align-items-center">
                      Tên đơn vị<div type="text" display="menu" class="ml-auto"></div>
                  </div>
              </th>
              <th style="min-width: 10rem">
                  <div class="flex justify-content-between align-items-center">               
                      Loại hình đơn vị<div type="text" display="menu" class="ml-auto"></div>
                  </div>
              </th>
              <th style="min-width: 10rem">
                <div class="flex justify-content-between align-items-center">               
                    Địa chỉ<div type="text" display="menu" class="ml-auto"></div>
                </div>
            </th>
            <th style="min-width: 10rem">
              <div class="flex justify-content-between align-items-center">               
                  Người đại diện<div type="text" display="menu" class="ml-auto"></div>
              </div>
          </th>
          
              <th style="min-width: 10rem">
                  <div>
                      Chức năng
                  </div>
              </th>
              
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
          <tr class="p-selectable-row">

              <td>
                  <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
              </td>
              <td>
                  <span class="p-column-title">STT</span>
                  {{ rowIndex + 1}}
              </td>
              <td>
                  <span class="ml-1 vertical-align-middle">{{ rowData.maDonVi }}</span>
              </td>
              <td>
                  <span class="ml-1 vertical-align-middle">{{ rowData.tenDonVi }}</span>
              </td>
           
              <td>
                  <span class="ml-1 vertical-align-middle">{{ rowData.maLoaiHinh }}</span>
              </td>
              <td>
                <span class="ml-1 vertical-align-middle">{{ rowData.diaChi }}</span>
            </td>
            <td>
              <span class="ml-1 vertical-align-middle">{{ rowData.maLoaiHinh }}</span>
          </td>
              <td>
                  <a class="m-3"><span data-toggle="modal" data-target="#createForm" (click)="Edit(rowData)" class="pi pi-pencil" title="Cập nhật" aria-hidden="true"></span></a>

                  <a class="m-3"><span class="pi pi-trash" title="Xoá" (click)="Delete(rowData)" style="color: red;" aria-hidden="true"></span></a>
              </td>
          </tr>
      </ng-template>
    
  </p-table>
  <div class="card flex justify-content-center">
      <p-paginator (onPageChange)="onPageChange($event)"[first]="first" [rows]="pageSize" [totalRecords]="100" [rowsPerPageOptions]="[5, 10, 50]"></p-paginator>
      
  </div>
</div>




<!-- modal -->
<div class="modal fade" id="createForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel" *ngIf="showadd == true">Thêm mới đơn vị</h5>
          <h5 class="modal-title" id="exampleModalLabel" *ngIf="showadd == false">Cập nhật đơn vị</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form method="POST" [formGroup]="FormObjectSurvey" (ngSubmit)="Save()">
            <h6>Thông tin đơn vị </h6>
            <div class="form-group">
              <label for="recipient-name" class="col-form-label">Tên đơn vị: <span style="color: red;">*</span></label>
              <input type="text" formControlName="TenDonVi"class="form-control" id="recipient-name">
            </div>
            <p-message severity="error" text="Tên đơn vị Không Được Rỗng"
                *ngIf="!FormObjectSurvey.controls['TenDonVi'].valid && FormObjectSurvey.controls['TenDonVi'].dirty">
                </p-message>
            <div class="row">
                <div class="form-group col-md-6">
                  <label for="loaihinhdonvi" class="col-form-label">Loại hình đơn vị: <span style="color: red;">*</span></label>
                  <select formControlName="MaLoaiHinh"class="custom-select" id="loaihinhdonvi">
                    <option selected value="">Chọn loại hình đơn vị</option>
                    <option *ngFor="let item of listloaihinhdonvi" [value]="item.maLoaiHinh">{{ item.tenLoaiHinh }}</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <label for="loaihinhdonvi" class="col-form-label">Lĩnh vực hoạt động: </label>
                  <select formControlName="MaLinhVuc"class="custom-select" id="loaihinhdonvi">
                    <option selected value="">Chọn lĩnh vực hoạt động</option>
                    <option value="1">One</option>
                    <option value="2">Two</option>
                    <option value="3">Three</option>
                  </select>
                </div>
                <div class="form-group col-md-6">
                  <label for="sothue" class="col-form-label">Mã số thuế: </label>
                  <input formControlName="MaSoThue"type="text" class="form-control" id="sothue">
                </div>
                <div class="form-group col-md-6">
                  <label for="Website" class="col-form-label">Website:</label>
                  <input formControlName="WebSite"type="text" class="form-control" id="Website">
                </div>
                <div class="form-group col-md-6">
                  <label for="Email" class="col-form-label">Email: <span style="color: red;">*</span></label>
                  <input formControlName="Email"type="text" class="form-control" id="Email">
                </div>
                <div class="form-group col-md-6">
                  <label for="sdt" class="col-form-label">Số điện thoại: <span style="color: red;">*</span></label>
                  <input formControlName="SoDienThoai"type="text" class="form-control" id="sdt">
                </div>
            </div>
            <div class="row" formGroupName="DiaChi">
              <label for="loaihinhdonvi" class="col-form-label">Địa chỉ: <span style="color: red;">*</span></label>
              <div class="form-group col-md-3">
                <select formControlName="TinhThanh"class="custom-select" id="loaihinhdonvi"(change)="onCityChange($event)">
                  <option selected value="" >Chọn Tỉnh/ Thành phố</option>
                  <option *ngFor="let city of cities" [value]="city.Id">{{ city.Name }}</option>
                </select>
              </div>
              <div class="form-group col-md-3">
                <select formControlName="QuanHuyen"class="custom-select" id="loaihinhdonvi"(change)="onDistrictChange($event)">
                  <option selected value="" >Chọn Quận/ huyện</option>
                  <option *ngFor="let district of districts" [value]="district.Id">{{ district.Name }}</option>
                </select>
              </div>
              <div class="form-group col-md-3">
                <select formControlName="PhuongXa"class="custom-select" id="loaihinhdonvi">
                  <option selected value="" >Chọn Phường/ Xã</option>
                  <option *ngFor="let ward of wards" [value]="ward.Id">{{ ward.Name }}</option>
                </select>
              </div>
              <div class="form-group col-md-3">
                <input type="text" formControlName="DiaChiChiTiet"class="form-control" id="sdt" placeholder="Nhập địa chỉ chi tiết">
              </div>
            </div>
            <hr>
            <h6>Thông tin người đại diện </h6>
            <div class="row" formGroupName="listRepresentative">
              <div class="form-group col-md-6">
                <label for="hoten" class="col-form-label">Họ tên: <span style="color: red;">*</span></label>
                <input formControlName="HoTen" type="text" class="form-control" id="hoten">
              </div>
              <div class="form-group col-md-6">
                <label for="chucvu" class="col-form-label">Chức vụ: <span style="color: red;">*</span></label>
                <input formControlName="ChucVu" type="text" class="form-control" id="chucvu">
              </div>
              <div class="form-group col-md-6">
                <label for="Email" class="col-form-label">Email: <span style="color: red;">*</span></label>
                <input formControlName="Email" type="text" class="form-control" id="Email">
              </div>
              <div class="form-group col-md-6">
                <label for="sdt" class="col-form-label">Số điện thoại: <span style="color: red;">*</span></label>
                <input formControlName="SoDienThoai" type="text" class="form-control" id="sdt">
              </div>
              <div class="col-md-12">
                <textarea formControlName="MoTa" name="" id="" cols="147" rows="5" placeholder="Nhập mô tả"></textarea>
              </div>
            </div>            
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
          <button type="button" (click)="Save()" class="btn btn-primary">Lưu</button>
        </div>
      </div>
    </div>
  </div>